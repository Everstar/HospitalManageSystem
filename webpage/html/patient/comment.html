<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>暴走医疗管理系统</title>
    <link rel="stylesheet" type="text/css" href="../../css/index.css">
    <link rel="stylesheet" type="text/css" href="../../css/ace.css">
    <link rel="stylesheet" type="text/css" href="../../css/rating.css">
    <link rel="stylesheet" href="../../bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="../../bootstrap/dist/css/bootstrap-theme.css">
    <script src="../../js/jquery-3.1.0.min.js"></script>
    <script src="../../js/parse_parameter.js"></script>
</head>
<body>
<div class="nav">
    <div class="nav_title">
        <img class="title_image" src="../../image/title_img.png" alt="">
        <div class="title">
            暴走医疗管理系统
        </div>
    </div>
    <div class="nav_right">
        <span>欢迎，</span>
        <span id="titlename">名字</span>
    </div>
</div>
<div class="main">
    <div class="siderbar">
        <ul class="menu unstyled">
            <li class="siderbar_selected"><span class="glyphicon glyphicon-user"></span><a
                    href="user_info.html">个人信息</a></li>
            <li><a href="register.html"><span class="glyphicon glyphicon-plus"></span>预约挂号</a></li>
            <li><a href="treatment.html"><span class="glyphicon glyphicon-star"></span>就诊记录</a></li>
        </ul>
    </div>
    <div class="content">
        <div class="row">
            <div class="col-sm-12">
                <div class="page-header">
                    <h1>信息中心
                        <small>>>个人资料</small>
                    </h1>
                </div><!-- /.page-header -->
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <ul class="breadcrumb">
                    <li>
                        医疗流水号 <span id="treatment_id">20160718103700000021</span>
                    </li>
                </ul><!-- .breadcrumb -->

                <ul class="rating">
                    <li class="star" id="1">&star;</li>
                    <li class="star" id="2">&star;</li>
                    <li class="star" id="3">&star;</li>
                    <li class="star" id="4">&star;</li>
                    <li class="star" id="5">&star;</li>
                </ul>

                <textarea id="commentContent" class="form-control" rows="5" maxlength="2000"
                          placeholder="请输入评价内容"></textarea>

                <div id="commentSubmit">
                    <button id="button_submit" class="btn btn-primary">提交</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../../js/employee_info.js"></script>
<script type="text/javascript">
    var url = "api/Patient/GetDoctorIdName";

    $(document).ready(function () {
        $("#treatment_id").html(GetQueryString("treatment_id"));
    });

    var level = 0;

    $(function () {
            $('li').on('click', function () {
                var selectedCssClass = 'selected';
                var $this = $(this);
                $this.siblings('.' + selectedCssClass).removeClass(selectedCssClass);
                $this
                        .addClass(selectedCssClass)
                        .parent().addClass('vote-cast');

                level = $(this).attr("id");
            });
        }
    );

    $("#button_submit").click(function () {
        if (level === 0) {
            alert("请打出一个等级。");
            return;
        }

        $.getJSON('../../../api/Account/GetUserInfo')
            .done(function (data) {
                var commentVal = { 
                    patient_id : data.patient_id,
                    treat_id : $("#treatment_id").html(),
                    rank : level,
                    content : $("#commentContent").val()
                };
                $.ajax({
                    type: "post",
                    url: "../../../api/Patient/Comment",
                    contentType: "application/json",
                    data: JSON.stringify(commentVal),
                    success: function (data, status) {
                        alert("评论成功");
                        window.location.href = "treatment.html";
                    },
                    error : function() {
                        alert("已经评论过");
                        window.location.href = "treatment.html";  
                    }
                });
        });



//        console.log("工号 " + $("#doctor_name").attr("alt") + "医疗流水号 " + $("#treatment_id").html() + "等级" + level + "评价内容" + $("#commentContent").val());
    });
</script>

</body>
</html>