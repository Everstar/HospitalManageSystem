<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>暴走医疗管理系统</title>
	<link rel="stylesheet" type="text/css" href="../../css/index.css">
	<link rel="stylesheet" type="text/css" href="../../css/ace.css">
	<link rel="stylesheet"  href="../../bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet"  href="../../bootstrap/dist/css/bootstrap-theme.css">
	<script src="../../js/jquery-3.1.0.min.js"></script>
</head>
<body>
	<div class="nav">
		<div class="nav_title">
			<img class="title_image" src="../../image/title_img.png" alt="">
			<div class="title">
				暴走医疗管理系统
			</div>
		</div>
		<div class="nav_right">
			<span>欢迎，</span>
			<span id="titlename">名字</span>
			<button id="signout" class="btn btn-primary" style="margin-left:15px;">退出</button>
		</div>
	</div>
	<div class="main">
		<div class="siderbar">
			<ul class="menu unstyled">
				<li><span class="glyphicon glyphicon-user"></span><a href="user_info.html">个人信息</a></li>
				<li class="siderbar_selected"><a href="hospitalization.html"><span class="glyphicon glyphicon-plus"></span>住院信息</a></li>
			</ul>
		</div>
		<div class="content">
			<div class="row">
				<div class="col-sm-12">
					<div class="page-header">
						<h1>信息中心
						<small>>>住院信息</small>
						</h1>
					</div><!-- /.page-header -->
				</div>
			</div>
			<div class="row">
				<div class="col-sm-12">
					<div class="row">
						<div class="col-xs-12">
							<div class="table-responsive">
								
								<table class="table table-striped table-bordered table-hover">
									<thead>
										<tr>
											<th>住院记录号</th>
											<th>病人姓名</th>
											<th>床号</th>
											<th>护理级别</th>
											<th>入院日期</th>
											<th>出院日期</th>
											<th></th>
										</tr>
									</thead>

									<tbody id="dischargedate">
<!-- 										<tr>
											<td class="hos_id">20160716222100000000</td>
											<td>ace</td>
											<td>206H</td>
											<td>2</td>
											<td>2016/07/17</td>
											<td class="out_time"></td>

											<td>
												<div idclass="visible-md visible-lg hidden-sm hidden-xs action-buttons">
													<button class="blue leave" >出院</button>
												</div>
											</td>

										</tr>

										<tr>
											<td class="hos_id">20160716222100000012</td>
											<td>base</td>
											<td>212B</td>
											<td>4</td>
											<td>2016/07/16</td>
											<td class="out_time"></td>

											<td>
												<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">
													<button class="blue leave">出院</button>
												</div>
											</td>

										</tr>

										<tr>
											<td class="hos_id">20160716222100000042</td>
											<td>Terminator</td>
											<td>313A</td>
											<td>2</td>
											<td>2016/07/17</td>
											<td class="out_time"></td>

											<td>
												<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">
													<button class="blue leave">出院</button>
												</div>
											</td>

										</tr> -->

									</tbody>								
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>	
	</div>
    <script src="../../js/employee_info.js"></script>
	<script type="text/javascript">
	var addListener = function() {
		$(".leave").click(function() {
	        $.getJSON('../../../api/Nurse/OutHospital/' + $(this).parent().parent().parent().find(".hos_id").html())
	        	.done(function (data) {
        			$(this).attr("disabled", "disabled");
					$(this).removeClass("blue");
					$(this).addClass("black");
					$(this).html("已出院");
					var d = new Date();
					var dateStr = (d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate()).toString();
					$(this).parent().parent().parent().find(".out_time").html(dateStr);
		    });
		});
	}

	var setData = function(hos_id, patient_name, bed_num, rank, in_time) {
		var element = "<tr><td class=\"hos_id\">" + hos_id +  "</td><td>" + patient_name + "</td><td>" + bed_num +"</td><td>" + rank + "</td><td>" + in_time + "</td><td class=\"out_time\"></td><td><div class=\"visible-md visible-lg hidden-sm hidden-xs action-buttons\"><button class=\"blue leave\">出院</button></div></td></tr>";
    	$("#dischargedate").append(element);
    	addListener();
	}

	$(document).ready(function(){
        $.getJSON('../../../api/Nurse/GetHospitalization')
        	.done(function (data) {
	            console.log(data);
                if (data === null) {
                	alert("error");
                }else {
                	for(i = 0; i < data.length; i++)
                		setData(data[i].hosp_id, data[i].patient_name, data[i].bed_num, data[i].nursing_rank, data[i].in_hosp_time);
                }
	    })
	    .fail(function(){
	    	alert('error!');
	    });
        addListener();
	});


		
	</script>
</body>
</html>