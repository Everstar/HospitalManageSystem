<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>暴走医疗管理系统</title>
    <link rel="stylesheet" type="text/css" href="../../css/index.css">
    <link rel="stylesheet" type="text/css" href="../../css/ace.css">
    <link rel="stylesheet" href="../../bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="../../bootstrap/dist/css/bootstrap-theme.css">
    <script src="../../js/jquery-3.1.0.min.js"></script>
</head>

<body>
    <div class="nav">
        <div class="nav_title">
            <img class="title_image" src="../../image/title_img.png" alt="">
            <div class="title">
                暴走医疗管理系统
            </div>
        </div>
        <div class="nav_right">
            <span>欢迎，</span>
            <span id="titlename">名字</span>
            <button id="signout" class="btn btn-primary" style="margin-left:15px;">退出</button>
        </div>
    </div>
    <div class="main">
        <div class="siderbar">
            <ul class="menu unstyled">
                <li><span class="glyphicon glyphicon-user"></span><a href="user_info.html">个人信息</a></li>
                <li><a href="prescribe.html"><span class="glyphicon glyphicon-plus"></span>配药</a></li>
            </ul>
        </div>
        <div class="content">
            <div class="row">
                <div class="col-sm-12">
                    <div class="page-header">
                        <h1>信息中心
						<small>>>配药信息</small>
						</h1>
                    </div>
                    <!-- /.page-header -->
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="table-responsive">
                                <div class="col-xs-12 searchMonth">
                                    处方号
                                    <input type="searchpres_id" id="searchpres_id" onkeydown="search(this)">
                                </div>
                                <div class="table-responsive">
                                    <table id="prescibe_info" class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>处方号</th>
                                                <th>病人姓名</th>
                                                <th>病人性别</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody id="prescribe_record">
<!--                                             <tr>
                                                <td class="pres_id">20160716222100000000</td>
                                                <td>ace</td>
                                                <td>男</td>
                                                <td>
                                                    <div idclass="visible-md visible-lg hidden-sm hidden-xs action-buttons">
                                                        <button class="blue prescribe">配药</button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="pres_id">20160716222100000012</td>
                                                <td>base</td>
                                                <td>女</td>
                                                <td>
                                                    <div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">
                                                        <button class="blue prescribe">配药</button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="pres_id">20160716222100000042</td>
                                                <td>Terminator</td>
                                                <td>男</td>
                                                <td>
                                                    <div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">
                                                        <button class="blue prescribe">配药</button>
                                                    </div>
                                                </td>
                                            </tr> -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="../../js/employee_info.js"></script>
        <script type="text/javascript">

        var addListener = function() {
	        $(".prescribe").click(function() {
	        	var target_id = $(this).parent().parent().parent().find(".pres_id").html();
        		window.location.href = "./medicinelist.html?pres_id=" + target_id;
    	    });
        }

        var addData = function(pres_id, name, sex){
        	var record = "<tr><td class=\"pres_id\">" + pres_id + "</td><td>" + name + "</td><td>" + sex + "</td><td><div class=\"visible-md visible-lg hidden-sm hidden-xs action-buttons\"><button class=\"blue prescribe\">配药</button></div></td></tr>";
        	$("#prescribe_record").append(record);
        	addListener();
        }


        $(document).ready(function(){
	        $.getJSON('../../../api/Pharmacist/GetAllPrescription')
	            .done(function (data) {
	                if (data === null/*“返回列表空”*/) {
	                    return;
	                }else {
	                	for(i = 0; i < data.length; i++)
	                		addData(data[i].pres_id, data[i].patientname, data[i].sex === "M" ? "男" : "女");
	                }
        	});
        });

        function search(obj) {
            setTimeout(function() {
                var storeId = document.getElementById('prescibe_info');

                var key = obj.value;

                var searchCol = 0;

                for (var i = 1; i < storeId.rows.length; i++) {
                    var searchText = storeId.rows[i].cells[searchCol].innerText;

                    if (searchText.match(key)) {
                        storeId.rows[i].style.display = 'table-row';
                    } else {
                        storeId.rows[i].style.display = 'none';
                    }
                }
            }, 200);

        }
        </script>
</body>

</html>
